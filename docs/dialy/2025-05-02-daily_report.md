
🧾 18QUAD 開発日報 - 2025年5月2日（第15日）

💥 ランキングが死んでる！？集計データ迷子事件

朝──。  
俺は何気なく月別ランキングを開いた。  
しかし、そこには…何もなかった。

「おかしい、Firestoreには確かに集計されてるはずだ…！」

この日、俺は時点の表示ではなく、  
そもそもランキングそのものが表示されないという地獄と向き合うことになる──。

🔍 捜査開始：幽霊集計データを追え

- 月別 `daily_counts_summary` に確かに2025-05がある
- しかしランキングに表示されない

🧱 原因候補一覧

- ❓ Firestoreのクエリミス？  
- ❓ インデックス不足？  
- ❓ データの `null`？  
- ❓ コレクショングループ vs サブコレクション問題？  
- ❓ そもそもコードが壊れてる？

🔨 対策

- ✅ Firestoreのインデックスを確認・設定
- ✅ `getRankingList()` の集計クエリと返却形式を洗い出し
- ✅ `snapshot.data!.isEmpty` の判定位置を何度もトレース
- ✅ 表示ラベルではなく、“データの有無”を見る目を鍛え直す

💫 “時点”表示の整備は、あくまで副産物

たしかにこの日、`※2025年05月02日時点` のような統一表示を整えた。  
しかしそれは…生き残った者が語れる、ランキング戦争の後日談に過ぎない。

🧙‍♂️ 五所川原のつぶやき

「ランキングにデータがない時、真に焦るべきは日付じゃなくて中身だ。」

名言。  
彼はそのまま集計テーブルの `updatedAt` にログを仕込んで去っていった。

📘 明日への引き継ぎ

- 🔁 Firestoreから正しい集計サマリが返るか、クエリごとに実地検証
- 🛠️ `daily_counts_summary` の構造統一と必要なフィールドの見直し
- 🧪 実際のUI上で月別・年別・総数すべてが正しく表示されるか検証

明日こそ、データが“ある”ランキングを表示できるようにしよう。  
俺はまだ…1割も出していない。リミッターがあと10個あるぜ。
